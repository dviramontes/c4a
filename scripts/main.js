$(function(){function t(){Tabletop.init({key:a,callback:n,simpleSheet:!0})}function e(t){var e=_.pluck(t,"violationcategory"),n=_.unique(e),a=[],r=function(t){this.name=t,this.count=0,this.dates=[]};r.prototype.getLatest=function(){return _.max(this.dates,function(t){return t.unix()})},r.prototype.getOldest=function(){return _.min(this.dates,function(t){return t.unix()})},_.each(n,function(t){return a.push(new r(t))}),_.each(e,function(t){_.each(n,function(e){var n;t===e&&(n=t,_.find(a,{name:n}).count+=1)})}),_.each(t,function(t){var e=t.violationcategory,r=t.violationdate.split(" ")[0],o=moment(r);_.each(n,function(t){var n;e===t&&(n=e,moment(o).isValid()&&_.find(a,{name:n}).dates.push(o))})});var o=_.reduce(a,function(t,e){return e.count+t},0),c=_.max(a,function(t){return t.count}),s=_.min(a,function(t){return t.count});console.dir(a),console.assert(e.length==o,"watch out, totals do not addup!");var l=500,i=380;d3.select(".jumbotron").append("svg").attr("class","viz").attr("width",l).attr("height",i);{var u=d3.select("svg"),d=(c.count,s.count,d3.scale.linear().domain([1,200]).range([1,390])),f=d3.svg.axis().scale(d).orient("top").ticks(6),p=u.append("g").attr("class","axis");u.append("g").attr("class","bars")}f(p),p.append("text").attr("class","xlabel").attr("text-anchor","end").attr("x",250).attr("y",-40).text("violations"),p.attr("transform","translate(25,50)"),p.selectAll("path").style({fill:"none",stroke:"#000"}),p.selectAll("line").style({stroke:"#000"});var h;u.append("g").attr("class","chart"),u.append("g").attr("class","textField"),d3.select("g.textField").append("text").attr("class","hoverme").attr("text-anchor","left").attr("x",100).attr("y",i-20).attr("dx",5).attr("dy",".36em").text("Hover over violation category to view more");d3.select(".hoverme");h=d3.select("g.chart"),h.attr("transform","translate(25,50)");var m=d3.scale.linear().domain([0,a.length]).range(["orange","red"]);h.selectAll("rect").data(a).enter().append("rect").transition().attr("x",0).attr("y",function(t,e){return 30*e+1}).attr("width",0).transition().attr("width",function(t){return 2*t.count}).attr("height",30).attr("fill",function(t,e){return m(e)}),h.append("g").attr("class","names"),h.append("g").attr("class","count"),h.select("g.names").selectAll("text").data(a).enter().append("text").attr("class","name").attr("x",0).attr("y",function(t,e){return 30*e+15}).attr("dx",5).attr("dy",".36em").attr("text-anchor","left").text(function(t){return t.name}).on("mouseover",function(t){var e="dddd, MMMM Do YYYY",n=["Oldest: "+t.getOldest().format(e)," Latest: "+t.getLatest().format(e)];console.log(n),d3.select(".hoverme").transition().text(n).attr("dx",0).attr("dy",".30em").attr("x",25).attr("y",i-20).attr("fill","blue")}).on("mouseleave",function(){d3.select(".hoverme").transition().delay(200).text("Hover over violation category to view more").attr("fill","black").attr("x",100).attr("y",i-20)}),h.select("g.count").selectAll("text").data(a).enter().append("text").attr("class","count").attr("x",function(t){return t.count>=20?2*t.count-10:-20}).attr("y",function(t,e){return 30*e+15}).attr("dx",8).attr("dy",".26em").attr("text-anchor","end").text(function(t){return t.count}).attr("fill",function(t,e){return t.count>=20?"white":m(e)})}function n(t){console.info("Successfully processed!"),e(t)}var a="https://docs.google.com/spreadsheets/d/1gfPjLfIJHXSH5plx-FgThng0S1t9JKIfujm_9KK-V5w/pubhtml";t()});